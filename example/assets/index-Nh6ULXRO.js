(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function e(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(r){if(r.ep)return;r.ep=!0;const n=e(r);fetch(r.href,n)}})();const rt=()=>[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],vt=s=>-(Math.cos(Math.PI*s)-1)/2;function gt(s,t,e=.1,i=.001){const r=t-s;return r<i?t:s+r*e}function A(s,t,e,i=.1,r=.001){const n=t-s.x,o=e-s.y;Math.sqrt(n**2+o**2)<r?(s.x=t,s.y=e):(s.x+=n*i,s.y+=o*i)}function nt(s,t,e,i){const r=e-t;return r<=i?t+r*.5:(t+=i*.5,s<t?t:(e-=i*.5,s>e?e:s))}function ot(s,t,e){const i=s*e;return(t%2===0?Math.round(i):Math.round(i+.5)-.5)/e}class K{constructor(){this.x=0,this.y=0,this.bounds=null,this.snapToPixel=!0,this.projection=rt(),this.modelView=rt(),this.zoom=1,this.viewportWidth=0,this.viewportHeight=0,this.projection[10]=-1,this.projection[14]=-1,this.projection[15]=1,this.modelView[0]=1,this.modelView[5]=-1,this.modelView[10]=-1,this.modelView[15]=1}getX(){return this.x}getY(){return this.y}getZoom(){return this.zoom}getViewportWidth(){return this.viewportWidth}getViewportHeight(){return this.viewportHeight}setZoom(t){this.zoom=t,this.updateProjection()}setPosition(t,e){if(this.bounds){const{xMin:i,xMax:r,yMin:n,yMax:o}=this.bounds;t=nt(t,i,r,this.viewportWidth/this.zoom),e=nt(e,n,o,this.viewportHeight/this.zoom)}this.x=t,this.y=e,this.snapToPixel?(this.modelView[12]=-ot(t,this.viewportWidth,this.zoom),this.modelView[13]=ot(e,this.viewportHeight,this.zoom)):(this.modelView[12]=-t,this.modelView[13]=e)}moveTo(t,e){this.setPosition(t,e)}resize(t,e){this.viewportWidth=t,this.viewportHeight=e,this.updateProjection()}updateProjection(){this.projection[0]=2*this.zoom/this.viewportWidth,this.projection[5]=2*this.zoom/this.viewportHeight}setBounds(t){this.bounds=t,this.setPosition(this.x,this.y)}getBounds(){return this.bounds}}class wt extends K{resize(t,e){super.resize(t,e),this.setPosition(t/2,e/2)}}class bt extends K{constructor(){super(...arguments),this.desired={x:0,y:0},this.speed=0,this.maxSpeed=900,this.acceleration=20,this.slowDistance=100,this.lockDistance=1}getDesired(){return this.desired}getSpeed(){return this.speed}update(t){const e=this.desired.x-this.x,i=this.desired.y-this.y,r=Math.sqrt(e**2+i**2);if(r!==0)if(r<this.slowDistance){const n=r/this.slowDistance;this.speed=Math.max(.1,n)*this.maxSpeed;const o=t*this.speed/r,a=e*o,h=i*o,u=Math.sqrt(a**2+h**2);r-u<=this.lockDistance?(this.speed=0,this.setPosition(this.desired.x,this.desired.y)):this.setPosition(this.x+a,this.y+h)}else{this.speed<this.maxSpeed&&(this.speed=Math.min(this.maxSpeed,this.speed+this.maxSpeed*this.acceleration*t));const n=t*this.speed/r;this.setPosition(this.x+e*n,this.y+i*n)}}moveInstantly(){this.setPosition(this.desired.x,this.desired.y)}moveTo(t,e){this.desired.x=t,this.desired.y=e}resize(t,e){super.resize(t,e),this.setPosition(this.desired.x,this.desired.y)}}class $ extends K{constructor(){super(),this.cueConfigs=[],this.target=null,this.offset={x:0,y:0},this.finalOffset={x:0,y:0},this.finalZoom=1,this.savedZoom=this.zoom}getOffset(){return this.offset}setZoom(t){this.savedZoom=t}updateZoom(t){t=gt(this.zoom,t),this.zoom!==t&&super.setZoom(t)}addCue(t){this.cueConfigs.push({cue:t,fadeTime:0,totalFadeTime:0,influence:1}),this.update(0)}removeCue(t,e=0){if(e>0){const i=this.cueConfigs.find(r=>r.cue===t);i&&!i.totalFadeTime&&(i.cue={...t},i.fadeTime=e,i.totalFadeTime=e)}else{const i=this.cueConfigs.findIndex(r=>r.cue===t);i>=0&&this.cueConfigs.splice(i,1)}}removeAllCues(t=0){if(t>0)for(const e of this.cueConfigs)e.totalFadeTime||(e.cue={...e.cue},e.fadeTime=t,e.totalFadeTime=t);else this.cueConfigs.length=0}setTarget(t){t&&this.target&&(this.offset.x+=this.target.x-t.x,this.offset.y+=this.target.y-t.y),this.target=t}getTarget(){return this.target}updateInfluences(){if(!this.target)return;let t=0,e=0,i=0,r=0,n=0;for(const c of this.cueConfigs){const{x:D,y:m}=c.cue,f=D-this.target.x,R=m-this.target.y,M=Math.sqrt(f**2+R**2);if(M<c.cue.outerRadius){const{outerRadius:O,innerRadius:S}=c.cue,F=O-S,k=M-S,w=(k<=0?1:1-vt(k/F))*c.influence;i+=w,w>e&&(e=w),r+=f*w,n+=R*w,t+=(1-c.cue.zoom)*w}}A(this.offset,0,0);let{x:o,y:a}=this.offset;const h=e/i;h&&(o+=r*h,a+=n*h);const{influences:u}=this.target,d=1-e;if(u.length!==0&&d){let c=0,D=0;for(const f of u)c+=f.x,D+=f.y;const m=d/u.length;o+=c*m,a+=D*m}this.finalOffset.x=o,this.finalOffset.y=a,this.finalZoom=this.savedZoom*this.target.zoom*(h?1-t*h:1)}update(t){if(this.updateFadingCues(t),!this.target){this.updateZoom(this.savedZoom);return}this.updateInfluences(),this.updateZoom(this.finalZoom),this.setPosition(this.target.x+this.finalOffset.x,this.target.y+this.finalOffset.y)}updateFadingCues(t){for(let e=this.cueConfigs.length-1;e>=0;e--){const i=this.cueConfigs[e];i.totalFadeTime&&(i.fadeTime-=t,i.fadeTime<=0?this.cueConfigs.splice(e,1):i.influence=i.fadeTime/i.totalFadeTime)}}resize(t,e){super.resize(t,e),this.setPosition(this.x,this.y)}moveTo(){throw new Error("moveTo is not supported on InfluencedCamera at this time.")}}const Et=.001;class J{constructor(t){this.desiredOffset={x:0,y:0},this.x=0,this.y=0,this.maxLength=t.maxLength,this.factor=t.factor??1,this.lerpFactor=t.lerpFactor??1,this.average={index:0,maxFrames:t.averageMaxFrames??30,frames:[{x:0,y:0}],sum:{x:0,y:0}}}set(t,e){if(this.maxLength<=0||this.factor===0)t=0,e=0;else{t*=this.factor,e*=this.factor;const i=Math.sqrt(t**2+e**2);if(i<Et)t=0,e=0;else if(i>this.maxLength){const r=this.maxLength/i;t*=r,e*=r}}this.desiredOffset.x=t,this.desiredOffset.y=e}update(){const{frames:t,maxFrames:e,sum:i}=this.average;let{x:r,y:n}=this.desiredOffset;if(i.x+=r,i.y+=n,t.length<e)t.push({x:r,y:n});else{const o=t[this.average.index];i.x-=o.x,i.y-=o.y,o.x=r,o.y=n}this.average.index=(this.average.index+1)%e,r=i.x/t.length,n=i.y/t.length,this.lerpFactor===1?(this.x=r,this.y=n):A(this,r,n,this.lerpFactor)}}const Q=Math.PI/180,Dt=180/Math.PI,U=854,G=480,x=6500,y=2889,lt={xMin:0,yMin:0,xMax:x,yMax:y},at=1400,B=32,j=100,W=.4,At=.5,ht=800,_=64,V=32,E=_;function I(s){const t=parseInt(s.substr(0,2),16)/255,e=parseInt(s.substr(2,2),16)/255,i=parseInt(s.substr(4,2),16)/255;return[t,e,i,1]}const v={RED:I("bb2222"),GREEN:I("009900"),CYAN:I("44dddd"),WHITE:I("ffffff"),PINK:I("ff66ff"),OLIVE:I("bbbb22")},Z={CAMERA:v.RED},N={CAMERA_DESIRED:v.GREEN,SLOW_DISTANCE:v.CYAN},p={TARGET_PROJECTED:v.WHITE,TARGET_AIM:v.CYAN,OFFSET:v.GREEN,CUE_INNER:v.PINK,CUE_OUTER:v.OLIVE};var P={},X={},Y={};Object.defineProperty(Y,"__esModule",{value:!0});Y.factoriesGl1=void 0;Y.factoriesGl1={uniform1f:(s,t)=>({location:t,set:e=>s.uniform1f(t,e),setV:e=>s.uniform1fv(t,e)}),uniform2f:(s,t)=>({location:t,set:(e,i)=>s.uniform2f(t,e,i),setV:e=>s.uniform2fv(t,e)}),uniform3f:(s,t)=>({location:t,set:(e,i,r)=>s.uniform3f(t,e,i,r),setV:e=>s.uniform3fv(t,e)}),uniform4f:(s,t)=>({location:t,set:(e,i,r,n)=>s.uniform4f(t,e,i,r,n),setV:e=>s.uniform4fv(t,e)}),uniform1i:(s,t)=>({location:t,set:e=>s.uniform1i(t,e),setV:e=>s.uniform1iv(t,e)}),uniform2i:(s,t)=>({location:t,set:(e,i)=>s.uniform2i(t,e,i),setV:e=>s.uniform2iv(t,e)}),uniform3i:(s,t)=>({location:t,set:(e,i,r)=>s.uniform3i(t,e,i,r),setV:e=>s.uniform3iv(t,e)}),uniform4i:(s,t)=>({location:t,set:(e,i,r,n)=>s.uniform4i(t,e,i,r,n),setV:e=>s.uniform4iv(t,e)}),uniformMatrix2f:(s,t)=>({location:t,set:(e,i)=>s.uniformMatrix2fv(t,e,i)}),uniformMatrix3f:(s,t)=>({location:t,set:(e,i)=>s.uniformMatrix3fv(t,e,i)}),uniformMatrix4f:(s,t)=>({location:t,set:(e,i)=>s.uniformMatrix4fv(t,e,i)}),vertexAttrib1f:(s,t)=>({location:t,set:e=>s.vertexAttrib1f(t,e),setV:e=>s.vertexAttrib1fv(t,e)}),vertexAttrib2f:(s,t)=>({location:t,set:(e,i)=>s.vertexAttrib2f(t,e,i),setV:e=>s.vertexAttrib2fv(t,e)}),vertexAttrib3f:(s,t)=>({location:t,set:(e,i,r)=>s.vertexAttrib3f(t,e,i,r),setV:e=>s.vertexAttrib3fv(t,e)}),vertexAttrib4f:(s,t)=>({location:t,set:(e,i,r,n)=>s.vertexAttrib4f(t,e,i,r,n),setV:e=>s.vertexAttrib4fv(t,e)}),vertexAttribPointer:(s,t)=>({location:t,enable:()=>s.enableVertexAttribArray(t),disable:()=>s.disableVertexAttribArray(t),set:(e,i,r,n,o)=>s.vertexAttribPointer(t,e,i,r,n,o)})};Object.defineProperty(X,"__esModule",{value:!0});X.factoriesGl2=void 0;const It=Y;X.factoriesGl2=Object.assign(Object.assign({},It.factoriesGl1),{uniform1ui:(s,t)=>({location:t,set:e=>s.uniform1ui(t,e),setV:(e,i,r)=>s.uniform1uiv(t,e,i,r)}),uniform2ui:(s,t)=>({location:t,set:(e,i)=>s.uniform2ui(t,e,i),setV:(e,i,r)=>s.uniform2uiv(t,e,i,r)}),uniform3ui:(s,t)=>({location:t,set:(e,i,r)=>s.uniform3ui(t,e,i,r),setV:(e,i,r)=>s.uniform3uiv(t,e,i,r)}),uniform4ui:(s,t)=>({location:t,set:(e,i,r,n)=>s.uniform4ui(t,e,i,r,n),setV:(e,i,r)=>s.uniform4uiv(t,e,i,r)}),uniformMatrix2x3f:(s,t)=>({location:t,set:(e,i,r,n)=>s.uniformMatrix2x3fv(t,e,i,r,n)}),uniformMatrix2x4f:(s,t)=>({location:t,set:(e,i,r,n)=>s.uniformMatrix2x4fv(t,e,i,r,n)}),uniformMatrix3x2f:(s,t)=>({location:t,set:(e,i,r,n)=>s.uniformMatrix3x2fv(t,e,i,r,n)}),uniformMatrix3x4f:(s,t)=>({location:t,set:(e,i,r,n)=>s.uniformMatrix3x4fv(t,e,i,r,n)}),uniformMatrix4x2f:(s,t)=>({location:t,set:(e,i,r,n)=>s.uniformMatrix4x2fv(t,e,i,r,n)}),uniformMatrix4x3f:(s,t)=>({location:t,set:(e,i,r,n)=>s.uniformMatrix4x3fv(t,e,i,r,n)}),vertexAttribDivisor:(s,t)=>({location:t,set:e=>s.vertexAttribDivisor(t,e)}),vertexAttribI4i:(s,t)=>({location:t,set:(e,i,r,n)=>s.vertexAttribI4i(t,e,i,r,n),setV:e=>s.vertexAttribI4iv(t,e)}),vertexAttribI4ui:(s,t)=>({location:t,set:(e,i,r,n)=>s.vertexAttribI4ui(t,e,i,r,n),setV:e=>s.vertexAttribI4uiv(t,e)}),vertexAttribIPointer:(s,t)=>({location:t,enable:()=>s.enableVertexAttribArray(t),disable:()=>s.disableVertexAttribArray(t),set:(e,i,r,n)=>s.vertexAttribIPointer(t,e,i,r,n)})});Object.defineProperty(P,"__esModule",{value:!0});var et=P.createShaderProgram=L=P.glsl=void 0;const Tt=X;function Rt(s,...t){let e="";for(let i=0;i<t.length;i++)e+=s[i],e+=t[i];return e.replace(/^[\r\n]+/,"")+s[s.length-1]}var L=P.glsl=Rt;function ct(s,t,e,i){const r=s.createShader(e);return s.shaderSource(r,i),s.compileShader(r),s.attachShader(t,r),r}function Mt(s,t,e,i){const r=s.createProgram(),n={},o=ct(s,r,s.VERTEX_SHADER,t),a=ct(s,r,s.FRAGMENT_SHADER,e);s.linkProgram(r),s.useProgram(r);for(const h of Object.keys(i)){const u=i[h],d=Tt.factoriesGl2[u];if(!d)throw new Error(`Can't handle ${u}!`);const c=u.startsWith("uniform")?s.getUniformLocation(r,h):s.getAttribLocation(r,h);n[h]=d(s,c)}return Object.assign(Object.assign({},n),{use(){s.useProgram(r)},dispose(){s.useProgram(null),s.deleteShader(a),s.deleteShader(o),s.deleteProgram(r)}})}et=P.createShaderProgram=Mt;const St=L`
attribute vec2 position;

uniform mat4 uMVMatrix;
uniform mat4 uPMatrix;

void main() {
    gl_Position = uPMatrix * uMVMatrix * vec4(position, 0.0, 1.0);
}
`,kt=L`
precision highp float;
uniform vec4 color;

void main() {
    gl_FragColor = color;
}
`;function Ct(s){return et(s,St,kt,{position:"vertexAttribPointer",uMVMatrix:"uniformMatrix4f",uPMatrix:"uniformMatrix4f",color:"uniform4f"})}class T{constructor(t,e,i){this.vertData=new Float32Array(8),this.gl=t,this.shader=e,this.vertBuffer=this.gl.createBuffer(),this.texture=i,this.uvBuffer=this.gl.createBuffer(),this.updateBuffer(this.uvBuffer,new Float32Array([0,1,0,0,1,0,1,1]))}destroy(){this.gl.deleteBuffer(this.vertBuffer),this.gl.deleteBuffer(this.uvBuffer)}set(t,e,i,r,n){const o=i/2,a=r/2,h=-o,u=-a,d=i-o,c=r-a,D=n*Q,m=Math.cos(D),f=Math.sin(D),R=m*h-f*c+t,M=f*h+m*c+e,O=m*h-f*u+t,S=f*h+m*u+e,F=m*d-f*c+t,k=f*d+m*c+e,w=O+(F-R),yt=k-(M-S);let b=0;return this.vertData[b++]=R,this.vertData[b++]=M,this.vertData[b++]=O,this.vertData[b++]=S,this.vertData[b++]=w,this.vertData[b++]=yt,this.vertData[b++]=F,this.vertData[b++]=k,this.updateBuffer(this.vertBuffer,this.vertData),this}updateBuffer(t,e){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t),this.gl.bufferData(this.gl.ARRAY_BUFFER,e,this.gl.STATIC_DRAW)}draw(){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertBuffer),this.shader.position.enable(),this.shader.position.set(2,this.gl.FLOAT,!1,0,0),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.uvBuffer),this.shader.uv.enable(),this.shader.uv.set(2,this.gl.FLOAT,!1,0,0),this.shader.textureID.set(0),this.gl.drawArrays(this.gl.TRIANGLE_FAN,0,4)}}function ut(s,t,e,i,r){let n=0,o=0;if(e&&(n+=1),r&&(n-=1),t&&(o-=1),i&&(o+=1),n||o){const a=1/Math.sqrt(n**2+o**2);s.x=n*a,s.y=o*a}else s.x=0,s.y=0}class _t{constructor(t){this.moveDirection={x:0,y:0},this.aimDirection={x:0,y:0},this.keys={ArrowUp:!1,ArrowDown:!1,ArrowLeft:!1,ArrowRight:!1,KeyW:!1,KeyA:!1,KeyS:!1,KeyD:!1,KeyT:!1,Space:!1},this.player=t,window.addEventListener("keyup",e=>this.onKeyUp(e)),window.addEventListener("keydown",e=>this.onKeyDown(e))}onKeyDown(t){if(t.code in this.keys){if(t.preventDefault(),this.keys[t.code])return;this.keys[t.code]=!0,t.code==="KeyT"?this.player.teleport():t.code==="Space"&&this.player.shootRocket()}}onKeyUp(t){t.code in this.keys&&(t.preventDefault(),this.keys[t.code]=!1)}update(){ut(this.moveDirection,this.keys.ArrowUp,this.keys.ArrowRight,this.keys.ArrowDown,this.keys.ArrowLeft),ut(this.aimDirection,this.keys.KeyW,this.keys.KeyD,this.keys.KeyS,this.keys.KeyA)}}class it{constructor(t,e,i){this.data=new Float32Array(i),this.gl=t,this.shader=e,this.vertBuffer=this.gl.createBuffer()}destroy(){this.gl.deleteBuffer(this.vertBuffer)}updateBuffer(){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.data,this.gl.DYNAMIC_DRAW)}prepareRender(t){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertBuffer),this.shader.position.enable(),this.shader.position.set(2,this.gl.FLOAT,!1,0,0),this.shader.color.setV(t)}}class tt extends it{constructor(t,e,i){super(t,e,4+i*2)}set(t,e,i){this.data[0]=t,this.data[1]=e;const r=this.data.length/2-2,n=Math.PI*2/r;let o=0;for(let a=0;a<r;a++)this.data[a*2+2]=t+i*Math.cos(o),this.data[a*2+3]=e+i*Math.sin(o),o+=n;return this.data[this.data.length-2]=this.data[2],this.data[this.data.length-1]=this.data[3],this.updateBuffer(),this}fill(t){this.prepareRender(t),this.gl.drawArrays(this.gl.TRIANGLE_FAN,0,this.data.length/2)}stroke(t){this.prepareRender(t),this.gl.drawArrays(this.gl.LINE_LOOP,2,this.data.length/2-2)}}class dt{constructor(t,e,i,r,n,o,a){const{gl:h,debugShader:u,defaultShader:d}=t;this.x=i,this.y=r,this.innerRadius=n,this.outerRadius=o,this.zoom=a,this.innerCircle=new tt(h,u,20).set(i,r,n),this.outerCircle=new tt(h,u,20).set(i,r,o),this.burstSprite=new T(h,d,e.texture),this.burstSprite.set(i,r,e.width,e.height,0)}draw(){this.burstSprite.draw()}drawDebug(t,e){t&&this.innerCircle.stroke(p.CUE_INNER),e&&this.outerCircle.stroke(p.CUE_OUTER)}}class Pt extends it{constructor(t,e){super(t,e,8)}set(t,e,i,r){const n=t+i,o=e+r;let a=0;return this.data[a++]=t,this.data[a++]=o,this.data[a++]=t,this.data[a++]=e,this.data[a++]=n,this.data[a++]=e,this.data[a++]=n,this.data[a++]=o,this.updateBuffer(),this}fill(t){this.prepareRender(t),this.gl.drawArrays(this.gl.TRIANGLE_FAN,0,4)}stroke(t){this.prepareRender(t),this.gl.drawArrays(this.gl.LINE_LOOP,0,4)}}class mt extends it{constructor(t,e){super(t,e,8)}set(t,e,i,r){const n=r*Q,o=Math.cos(n)*i,a=Math.sin(n)*i,h=(r+90)*Q,u=Math.cos(h)*i,d=Math.sin(h)*i;let c=0;return this.data[c++]=t+o,this.data[c++]=e+a,this.data[c++]=t-o,this.data[c++]=e-a,this.data[c++]=t+u,this.data[c++]=e+d,this.data[c++]=t-u,this.data[c++]=e-d,this.updateBuffer(),this}stroke(t){this.prepareRender(t),this.gl.drawArrays(this.gl.LINES,0,4)}}class st{constructor(t,e,i){this.game=t,this.player=e,this.camera=i,this.circle=new tt(t.gl,t.debugShader,20),this.crosshair=new mt(t.gl,t.debugShader),this.rect=new Pt(t.gl,t.debugShader),this.camera.resize(U,G),this.camera.setZoom(.5),this.camera.setBounds(lt)}onDisable(){}onEnable(){}update(t){}draw(){}drawDebug(){this.game.ui.boundaries.checked&&(this.rect.set(0,0,x,y),this.rect.stroke(v.RED))}}const Lt=document.getElementById("legend");class g{constructor(t,e){this.label=document.createElement("label"),this.checkbox=document.createElement("input"),this.checkbox.type="checkbox",this.checkbox.checked=!0,this.label.appendChild(this.checkbox);const i=document.createElement("span");if(i.textContent=t,e){const r=Math.round(e[0]*255),n=Math.round(e[1]*255),o=Math.round(e[2]*255),a=e[3].toFixed(2);i.style.color=`rgba(${r}, ${n}, ${o}, ${a})`}this.label.appendChild(i),Lt.appendChild(this.label),this.hide()}get checked(){return this.checkbox.checked}set checked(t){this.checkbox.checked=t}show(){return this.label.style.display="",this}hide(){return this.label.style.display="none",this}}const Ot=document.getElementById("options");class l{constructor(t,e,i=2){this.label=document.createElement("label"),this.fractionDigits=i;const r=document.createElement("span");r.textContent=`${t}:`,this.label.appendChild(r),this.input=document.createElement("input"),this.input.type="number";for(const n of Object.keys(e)){const o=e[n];o!==void 0&&(this.input[n]=o)}this.label.appendChild(this.input),Ot.appendChild(this.label),this.hide()}get value(){return parseFloat(this.input.value)}set value(t){this.input.value=t.toFixed(this.fractionDigits)}show(){return this.label.style.display="",this}hide(){return this.label.style.display="none",this}addListener(t){this.input.addEventListener("input",()=>{const{value:e}=this;e>0&&t(e)})}}class pt extends st{constructor(t,e,i){super(t,e,new $),this.ui={offset:new g("⨉ Offset (due to target change)",p.OFFSET),targetProjected:new g("☐ Target Projected",p.TARGET_PROJECTED),targetAim:new g("☐ Target Aim",p.TARGET_AIM),cueInner:new g("◯ Cue Inner Radius",p.CUE_INNER),cueOuter:new g("◯ Cue Outer Radius",p.CUE_OUTER),maxVelocityInfluence:new l("Max Velocity Influence",{min:"0"}),velocityInfluenceFactor:new l("Velocity Influence Factor",{min:"0",step:"0.1"}),maxAimInfluence:new l("Max Aim Influence",{min:"0"}),aimInfluenceFactor:new l("Aim Influence Factor",{min:"0",step:"0.1"}),aimInfluenceLerp:new l("Aim Influence Lerp",{min:"0",max:"1",step:"0.1"}),currentZoom:new l("Current Zoom",{disabled:!0,type:"text"},3)},this.cues=[],this.addCue(new dt(t,i,x/2+500,y/2-500,200,1e3,.6)),this.addCue(new dt(t,i,x/3,y-450,200,600,1.4)),this.camera.setTarget(e),this.ui.maxVelocityInfluence.value=e.velocityInfluence.maxLength,this.ui.velocityInfluenceFactor.value=e.velocityInfluence.factor,this.ui.maxAimInfluence.value=e.aimInfluence.maxLength,this.ui.aimInfluenceFactor.value=e.aimInfluence.factor,this.ui.aimInfluenceLerp.value=e.aimInfluence.lerpFactor,this.ui.maxVelocityInfluence.addListener(r=>e.velocityInfluence.maxLength=r),this.ui.velocityInfluenceFactor.addListener(r=>e.velocityInfluence.factor=r),this.ui.maxAimInfluence.addListener(r=>e.aimInfluence.maxLength=r),this.ui.aimInfluenceFactor.addListener(r=>e.aimInfluence.factor=r),this.ui.aimInfluenceLerp.addListener(r=>e.aimInfluence.lerpFactor=r)}addCue(t){this.cues.push(t),this.camera.addCue(t)}onDisable(){for(const t of Object.keys(this.ui))this.ui[t].hide();this.player.removeRocket()}onEnable(){for(const t of Object.keys(this.ui))this.ui[t].show()}update(t){this.camera.update(t),this.ui.currentZoom.value=this.camera.getZoom()}draw(){for(const t of this.cues)t.draw()}drawDebug(){super.drawDebug();for(const e of this.cues)e.drawDebug(this.ui.cueInner.checked,this.ui.cueOuter.checked);const t=this.camera.getTarget();if(t&&this.ui.offset.checked){const{x:e,y:i}=this.camera.getOffset();this.crosshair.set(t.x+e,t.y+i,16,45),this.crosshair.stroke(p.OFFSET)}this.ui.targetProjected.checked&&this.player.drawDebugProjected(this.rect),this.ui.targetAim.checked&&this.player.drawDebugAim(this.rect)}}function Ft(s){return xt(s.x,s.y)}function xt(s,t){if(s===0&&t===0)return 0;let e=Math.atan2(s,-t)*Dt;return e<0&&(e+=360),e}const ft=.3;class Bt{constructor(t,e,i){this.lastValidDirection={x:0,y:0},this.velocity={x:0,y:0},this.velocityInfluence=new J({maxLength:200,factor:.2}),this.influences=[],this.zoom=1.5,this.spawnTime=ft,this.lastValidDirection.x=i.x,this.lastValidDirection.y=i.y,this.x=e.x+this.lastValidDirection.x*j,this.y=e.y+this.lastValidDirection.y*j,this.game=t,this.sprite=new T(t.gl,t.defaultShader,t.textures.rocket.texture),this.influences.push(this.velocityInfluence)}update(t,e){let i=e.x,r=e.y;i===0&&r===0?(i=this.lastValidDirection.x,r=this.lastValidDirection.y):(this.lastValidDirection.x=i,this.lastValidDirection.y=r),A(this.velocity,i*at,r*at,.03),this.velocityInfluence.set(this.velocity.x,this.velocity.y);for(const n of this.influences)n.update();this.x+=this.velocity.x*t,this.y+=this.velocity.y*t,(this.x<0||this.x>=x||this.y<0||this.y>=y)&&this.game.player.removeRocket(),this.spawnTime>0&&(this.spawnTime=Math.max(0,this.spawnTime-t))}draw(){const t=this.getScale(),{width:e,height:i}=this.game.textures.rocket,r=Ft(this.velocity);this.sprite.set(this.x,this.y,e*t,i*t,r),this.sprite.draw()}drawDebugProjected(t){const{x:e,y:i}=this.velocityInfluence;t.set(this.x+e-B,this.y+i-B,B*2,B*2),t.stroke(p.TARGET_PROJECTED)}getScale(){const t=1-this.spawnTime/ft;return W+t*(At-W)}}const z=.3;class Vt{constructor(t){this.x=x/2,this.y=y/2,this.velocity={x:0,y:0},this.velocityInfluence=new J({maxLength:300,factor:.2}),this.aimInfluence=new J({maxLength:300,factor:.3,lerpFactor:.1}),this.smoothAimDirection={x:0,y:0},this.influences=[],this.zoom=1,this.spawnTime=z,this.rocket=null,this.input=new _t(this),this.game=t,this.sprite=new T(t.gl,t.defaultShader,t.textures.player.texture),this.rocketSprite=new T(t.gl,t.defaultShader,t.textures.rocket.texture),this.influences.push(this.velocityInfluence),this.influences.push(this.aimInfluence)}teleport(){if(!this.rocket){for(let t=0;t<10;t++){const e=E+Math.random()*(x-E*2),i=E+Math.random()*(y-E*2);if(Math.sqrt((e-this.x)**2+(i-this.y)**2)>500){this.x=e,this.y=i,this.spawnTime=z;return}}console.log("Could not find a new spot far away enough")}}shootRocket(){if(this.rocket)this.removeRocket();else if(this.input.aimDirection.x||this.input.aimDirection.y){const{camera:t}=this.game.mode;t instanceof $&&(this.rocket=new Bt(this.game,this,this.input.aimDirection),t.setTarget(this.rocket))}}removeRocket(){this.rocket=null;const{camera:t}=this.game.mode;t instanceof $&&t.setTarget(this)}update(t){this.input.update();let e=ht;this.rocket?(e=0,A(this.velocity,0,0),this.aimInfluence.set(0,0),this.rocket.update(t,this.input.aimDirection),A(this.smoothAimDirection,0,0)):A(this.smoothAimDirection,this.input.aimDirection.x,this.input.aimDirection.y),A(this.velocity,this.input.moveDirection.x*e,this.input.moveDirection.y*e),this.aimInfluence.set(this.input.aimDirection.x*e,this.input.aimDirection.y*e),this.velocityInfluence.set(this.velocity.x,this.velocity.y);for(const i of this.influences)i.update();this.x=Math.max(E,Math.min(x-E,this.x+this.velocity.x*t)),this.y=Math.max(E,Math.min(y-E,this.y+this.velocity.y*t)),this.spawnTime>0&&(this.spawnTime=Math.max(0,this.spawnTime-t))}draw(){const t=this.getScale(),{width:e,height:i}=this.game.textures.player;this.sprite.set(this.x,this.y,e*t,i*t,this.velocity.x/ht*25),this.sprite.draw(),this.rocket?this.rocket.draw():this.game.mode instanceof pt&&(this.input.aimDirection.x||this.input.aimDirection.y)&&this.drawPreviewRocket()}drawPreviewRocket(){let{x:t,y:e}=this.smoothAimDirection;const i=1/Math.sqrt(t**2+e**2);t*=i,e*=i;const{width:r,height:n}=this.game.textures.rocket,o=xt(t,e);this.rocketSprite.set(this.x+t*j,this.y+e*j,r*W,n*W,o),this.rocketSprite.draw()}drawDebugProjected(t){if(this.rocket)this.rocket.drawDebugProjected(t);else{const{x:e,y:i}=this.velocityInfluence;t.set(this.x+e-_,this.y+i-_,_*2,_*2),t.stroke(p.TARGET_PROJECTED)}}drawDebugAim(t){if(!this.rocket){const{x:e,y:i}=this.aimInfluence;t.set(this.x+e-V,this.y+i-V,V*2,V*2),t.stroke(p.TARGET_AIM)}}getScale(){return 1-this.spawnTime/z}}const Nt=L`
attribute vec2 position;
attribute vec2 uv;
varying vec2 vUV;

uniform mat4 uMVMatrix;
uniform mat4 uPMatrix;

void main() {
    vUV = uv;
    gl_Position = uPMatrix * uMVMatrix * vec4(position, 0.0, 1.0);
}
`,Ut=L`
precision highp float;
varying vec2 vUV;
uniform sampler2D textureID;
uniform vec2 uvOffset;

void main() {
    gl_FragColor = texture2D(textureID, vUV + uvOffset);
}
`;function Gt(s){return et(s,Nt,Ut,{position:"vertexAttribPointer",uv:"vertexAttribPointer",uMVMatrix:"uniformMatrix4f",uPMatrix:"uniformMatrix4f",textureID:"uniform1i",uvOffset:"uniform2f"})}class jt extends st{constructor(t,e){super(t,e,new bt),this.ui={cameraDesired:new g("⨉ Camera Desired",N.CAMERA_DESIRED),cameraSlowDistance:new g("◯ Camera Slow Distance",N.SLOW_DISTANCE),maxSpeed:new l("Max Speed",{min:"0.01"}),acceleration:new l("Acceleration",{min:"0.01"}),slowDistance:new l("Slow Distance",{min:"0"}),lockDistance:new l("Lock Distance",{min:"0"}),speed:new l("Speed",{disabled:!0,type:"text"})},this.camera.acceleration=40,this.camera.slowDistance=200;const{camera:i}=this;this.ui.maxSpeed.value=i.maxSpeed,this.ui.acceleration.value=i.acceleration,this.ui.slowDistance.value=i.slowDistance,this.ui.lockDistance.value=i.lockDistance,this.ui.maxSpeed.addListener(r=>i.maxSpeed=r),this.ui.acceleration.addListener(r=>i.acceleration=r),this.ui.slowDistance.addListener(r=>i.slowDistance=r),this.ui.lockDistance.addListener(r=>i.lockDistance=r)}onDisable(){for(const t of Object.keys(this.ui))this.ui[t].hide()}onEnable(){for(const e of Object.keys(this.ui))this.ui[e].show();const{camera:t}=this;t.moveTo(this.player.x,this.player.y),t.moveInstantly()}update(t){this.camera.moveTo(this.player.x,this.player.y),this.camera.update(t),this.ui.speed.value=this.camera.getSpeed()}drawDebug(){super.drawDebug();const{x:t,y:e}=this.camera.getDesired();this.ui.cameraDesired.checked&&(this.crosshair.set(t,e,16,45),this.crosshair.stroke(N.CAMERA_DESIRED)),this.ui.cameraSlowDistance.checked&&(this.circle.set(t,e,this.camera.slowDistance),this.circle.stroke(N.SLOW_DISTANCE))}}class Wt extends st{constructor(t,e){super(t,e,new K)}onEnable(){this.camera.moveTo(this.player.x,this.player.y)}update(){this.camera.moveTo(this.player.x,this.player.y)}}function H(s,t){t.use(),t.uMVMatrix.set(!1,s.modelView),t.uPMatrix.set(!1,s.projection)}class Kt{constructor(t,e,i){this.ui={cameraCurrent:new g("＋ Camera Current",Z.CAMERA).show(),boundaries:new g("☐ World Boundaries",Z.CAMERA).show(),zoom:new l("Zoom",{min:"0.125",max:"8",value:"0.5",step:"0.125"}).show(),debug:document.getElementById("debug")},this.textures=i,this.gl=e,e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE),e.enable(e.BLEND),this.debugShader=Ct(e),this.defaultShader=Gt(e),this.crosshair=new mt(e,this.debugShader),this.heartSprite=new T(e,this.defaultShader,i.heart.texture),this.bgSprite=new T(e,this.defaultShader,i.bg.texture),this.bgSprite.set(x/2,y/2,x,y,0),t.width=U,t.height=G,e.viewport(0,0,U,G),this.player=new Vt(this),this.modes={simple:new Wt(this,this.player),influenced:new pt(this,this.player,i.burst),following:new jt(this,this.player)},this.screenCamera=new wt,this.screenCamera.resize(U,G);const r=document.getElementById("mode");r.value="influenced",r.addEventListener("change",()=>{this.setMode(r.value)}),this.setMode(r.value);const n=document.getElementById("snapToPixel");n.checked=this.mode.camera.snapToPixel,n.addEventListener("input",()=>{for(const h of Object.keys(this.modes))this.modes[h].camera.snapToPixel=n.checked});const o=document.getElementById("useBounds");o.checked=!!this.mode.camera.getBounds(),o.addEventListener("input",()=>{const h=o.checked?lt:null;for(const u of Object.keys(this.modes))this.modes[u].camera.setBounds(h)}),this.mode.camera.setZoom(this.ui.zoom.value),this.ui.zoom.addListener(h=>{for(const u of Object.keys(this.modes))this.modes[u].camera.setZoom(h)});const a=document.getElementById("sidebar");a.addEventListener("keydown",h=>h.stopImmediatePropagation()),a.addEventListener("keyup",h=>h.stopImmediatePropagation()),a.addEventListener("keypress",h=>h.stopImmediatePropagation())}setMode(t){var i;const e=this.modes[t];e&&((i=this.mode)==null||i.onDisable(),this.mode=e,e.onEnable())}update(t){this.gl.clearColor(0,0,0,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.player.update(t),this.mode.update(t),H(this.mode.camera,this.defaultShader),this.bgSprite.draw(),this.mode.draw(),this.player.draw(),this.ui.debug.checked&&(H(this.mode.camera,this.debugShader),this.mode.drawDebug(),this.ui.cameraCurrent.checked&&(this.crosshair.set(this.mode.camera.getX(),this.mode.camera.getY(),16,0),this.crosshair.stroke(Z.CAMERA))),H(this.screenCamera,this.defaultShader);const e=this.textures.heart.width,i=this.textures.heart.height;for(let r=0;r<3;r++)this.heartSprite.set(5+e/2+(5+e)*r,5+i/2,e,i,0),this.heartSprite.draw()}}const Xt="/pixlcam/example/assets/background-TK6E3DhP.jpg",Yt="/pixlcam/example/assets/heart-Chcx2Dce.png",Zt="/pixlcam/example/assets/laserGreen_burst-KNirQ47T.png",zt="/pixlcam/example/assets/rocket-B3UCcMGC.png",Ht="/pixlcam/example/assets/shipPink_manned-D_9SW4p6.png";async function C(s,t){const e=await new Promise((r,n)=>{const o=new Image;o.onload=()=>r(o),o.onerror=a=>n(a),o.src=s}),i=t.createTexture();return t.bindTexture(t.TEXTURE_2D,i),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.bindTexture(t.TEXTURE_2D,i),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e),{width:e.width,height:e.height,texture:i}}async function qt(s){return{bg:await C(Xt,s),player:await C(Ht,s),heart:await C(Yt,s),burst:await C(Zt,s),rocket:await C(zt,s)}}const q=1/60;async function $t(){const s=document.getElementById("canvas"),t=s.getContext("webgl"),e=await qt(t),i=new Kt(s,t,e);let r=0,n=performance.now();function o(){const a=performance.now();for(r+=(a-n)/1e3,n=a;r>=q;)i.update(q),r-=q;window.requestAnimationFrame(o)}window.requestAnimationFrame(o)}$t();
